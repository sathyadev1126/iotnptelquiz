<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NPTEL Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f7fb;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 700px;
      width: 100%;
    }
    h1 { text-align: center; }
    .question-img {
      max-width: 100%;
      display: block;
      margin: 10px auto;
    }
    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 10px 0;
    }
    .options label {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: background 0.2s;
    }
    .options input { display: none; }
    .options input:checked + label {
      background: #64b5f6;
      color: white;
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 12px 24px;
      background: #1565c0;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover { background: #0d47a1; }
    .hidden { display: none; }
    #timer {
      text-align: right;
      font-weight: bold;
      color: #d32f2f;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>NPTEL Quiz</h1>

    <div id="student-info">
      <p><b>Enter your details to start:</b></p>
      <input type="text" id="name" placeholder="Your Name" required><br><br>
      <input type="text" id="roll" placeholder="Your Roll Number" required><br><br>
      <button onclick="startQuiz()">Start Quiz</button>
    </div>

    <form id="quiz-form" class="hidden">
      <div id="timer">Time Left: <span id="time">05:00</span></div>
      <div id="quiz-container"></div>
      <button type="submit">Submit Answers</button>
    </form>

    <div id="result" class="hidden"></div>
  </div>

<script>
const questions = [
     { img: "images/s1.png", correct: "d" },
  { img: "images/s2.png", correct: "a" },
  { img: "images/s3.png", correct: "a" },
  { img: "images/s4.png", correct: "b" },
  { img: "images/s5.png", correct: "c" },
  { img: "images/s6.png", correct: "b" },
  { img: "images/s7.png", correct: "a" },
  { img: "images/s8.png", correct: "b" },
  { img: "images/s9.png", correct: "d" },
  { img: "images/s10.png", correct: "a" },
  { img: "images/s11.png", correct: "c" },
  { img: "images/s12.png", correct: "a" },
  { img: "images/s13.png", correct: "d" },
  { img: "images/s14.png", correct: "b" },
  { img: "images/s15.png", correct: "d" },
  { img: "images/s16.png", correct: "d" },
  { img: "images/s17.png", correct: "d" },
  { img: "images/s18.png", correct: "d" },
  { img: "images/s19.png", correct: "b" },
  { img: "images/s20.png", correct: "d" },
  { img: "images/s21.png", correct: "d" },
  { img: "images/s22.png", correct: "d" },
  { img: "images/s23.png", correct: "b" },
  { img: "images/s24.png", correct: "b" },
  { img: "images/s25.png", correct: "c" },
  { img: "images/s26.png", correct: "b" },
  { img: "images/s27.png", correct: "a" },
  { img: "images/s28.png", correct: "a" },
  { img: "images/s29.png", correct: "b" },
  { img: "images/s30.png", correct: "b" },
  { img: "images/s31.png", correct: "d" },
  { img: "images/s32.png", correct: "a" },
  { img: "images/s33.png", correct: "b" },
  { img: "images/s34.png", correct: "c" },
  { img: "images/s35.png", correct: "a" },
  { img: "images/s36.png", correct: "c" },
  { img: "images/s37.png", correct: "d" },
  { img: "images/s38.png", correct: "b" },
  { img: "images/s39.png", correct: "b" },
  { img: "images/s40.png", correct: "b" },
  { img: "images/s41.png", correct: "a" },
  { img: "images/s42.png", correct: "c" },
  { img: "images/s43.png", correct: "c" },
  { img: "images/s44.png", correct: "a" },
  { img: "images/s45.png", correct: "a" },
  { img: "images/s46.png", correct: "d" },
  { img: "images/s47.png", correct: "d" },
  { img: "images/s48.png", correct: "b" },
  { img: "images/s49.png", correct: "d" },
  { img: "images/s50.png", correct: "b" },
  { img: "images/s51.png", correct: "c" },
  { img: "images/s52.png", correct: "a" },
  { img: "images/s53.png", correct: "b" },
  { img: "images/s54.png", correct: "d" },
  { img: "images/s55.png", correct: "b" },
  { img: "images/s56.png", correct: "b" },
  { img: "images/s57.png", correct: "c" },
  { img: "images/s58.png", correct: "a" },
  { img: "images/s59.png", correct: "a" },
  { img: "images/s60.png", correct: "b" },
  { img: "images/s61.png", correct: "a" },
  { img: "images/s62.png", correct: "c" },
  { img: "images/s63.png", correct: "b" },
  { img: "images/s64.png", correct: "a" },
  { img: "images/s65.png", correct: "b" },
  { img: "images/s66.png", correct: "d" },
  { img: "images/s67.png", correct: "d" },
  { img: "images/s68.png", correct: "c" },
  { img: "images/s69.png", correct: "a" },
  { img: "images/s70.png", correct: "a" },
  { img: "images/s71.png", correct: "b" },
  { img: "images/s72.png", correct: "b" },
  { img: "images/s73.png", correct: "a" },
  { img: "images/s74.png", correct: "b" },
  { img: "images/s75.png", correct: "c" },
  { img: "images/s76.png", correct: "a" },
  { img: "images/s77.png", correct: "a" },
  { img: "images/s78.png", correct: "b" },
  { img: "images/s79.png", correct: "c" },
  { img: "images/s80.png", correct: "d" },
  { img: "images/s81.png", correct: "b" },
  { img: "images/s82.png", correct: "a" },
  { img: "images/s83.png", correct: "b" },
  { img: "images/s84.png", correct: "c" },
  { img: "images/s85.png", correct: "b" },
  { img: "images/s86.png", correct: "a" },
  { img: "images/s87.png", correct: "a" },
  { img: "images/s88.png", correct: "c" },
  { img: "images/s89.png", correct: "b" },
  { img: "images/s90.png", correct: "b" },
  { img: "images/s91.png", correct: "c" },
  { img: "images/s92.png", correct: "a" },
  { img: "images/s93.png", correct: "d" },
  { img: "images/s94.png", correct: "b" },
  { img: "images/s95.png", correct: "d" },
  { img: "images/s96.png", correct: "d" },
  { img: "images/s97.png", correct: "d" },
  { img: "images/s98.png", correct: "d" },
  { img: "images/s99.png", correct: "b" },
  { img: "images/s100.png", correct: "d" },
  { img: "images/s101.png", correct: "d" },
  { img: "images/s102.png", correct: "d" },
  { img: "images/s103.png", correct: "b" },
  { img: "images/s104.png", correct: "b" },
  { img: "images/s105.png", correct: "c" }

];

let studentName = "";
let studentRoll = "";
let timerInterval;
let totalTime = 30 * 60; // 5 minutes

function shuffleArray(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function startQuiz() {
  studentName = document.getElementById("name").value.trim();
  studentRoll = document.getElementById("roll").value.trim();

  if (!studentName || !studentRoll) {
    alert("Please enter your name and roll number.");
    return;
  }

  document.getElementById("student-info").classList.add("hidden");
  document.getElementById("quiz-form").classList.remove("hidden");

  renderQuiz();
  startTimer();
}

function renderQuiz() {
  const quizContainer = document.getElementById("quiz-container");
  quizContainer.innerHTML = "";

  const shuffledQuestions = shuffleArray([...questions]);

  shuffledQuestions.forEach((q, index) => {
    const div = document.createElement("div");
    div.innerHTML = `
      <p><b>Question ${index+1}</b></p>
      <img src="${q.img}" alt="Question ${index+1}" class="question-img">
      <div class="options">
        <input type="radio" name="q${index}" id="q${index}a" value="a">
        <label for="q${index}a">A</label>
        <input type="radio" name="q${index}" id="q${index}b" value="b">
        <label for="q${index}b">B</label>
        <input type="radio" name="q${index}" id="q${index}c" value="c">
        <label for="q${index}c">C</label>
        <input type="radio" name="q${index}" id="q${index}d" value="d">
        <label for="q${index}d">D</label>
      </div>
    `;
    div.dataset.correct = q.correct;
    quizContainer.appendChild(div);
  });
}

function startTimer() {
  timerInterval = setInterval(() => {
    let minutes = Math.floor(totalTime / 60);
    let seconds = totalTime % 60;
    document.getElementById("time").textContent =
      `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;

    if (totalTime <= 0) {
      clearInterval(timerInterval);
      document.getElementById("quiz-form").requestSubmit();
    }
    totalTime--;
  }, 1000);
}

document.getElementById("quiz-form").addEventListener("submit", (e) => {
  e.preventDefault();
  clearInterval(timerInterval);

  let score = 0;
  let attempted = 0;
  let tableData = [];
  const quizContainer = document.getElementById("quiz-container").children;

  Array.from(quizContainer).forEach((div, index) => {
    const correct = div.dataset.correct;
    const selected = div.querySelector(`input[name="q${index}"]:checked`);
    let ans;

    if (selected) {
      attempted++;
      ans = selected.value.toUpperCase();
      if (ans.toLowerCase() === correct) score++;
    } else {
      ans = "-";
    }

    tableData.push([index+1, ans]);
  });

  // Determine Pass/Fail
  let resultStatus = score >= 30 ? "PASS" : "FAIL";

  // Generate PDF
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(18);
  doc.text("NPTEL Quiz Result", 105, 15, { align: "center" });
  doc.setFontSize(11);
  doc.text("Generated on: " + new Date().toLocaleString(), 105, 22, { align: "center" });

  doc.setFontSize(12);
  doc.text(`Name: ${studentName}`, 14, 35);
  doc.text(`Roll Number: ${studentRoll}`, 14, 42);
  doc.text(`Total Questions: ${questions.length}`, 14, 55);
  doc.text(`Attempted: ${attempted}`, 14, 62);
  doc.text(`Score: ${score} / ${questions.length}`, 14, 69);
  doc.text(`Result: ${resultStatus}`, 14, 76);

  // Table of answers
  doc.autoTable({
    startY: 90,
    head: [["Q.No", "Your Answer"]],
    body: tableData,
    theme: "grid",
    headStyles: { fillColor: [21, 101, 192] },
    styles: { halign: "center" },
    columnStyles: { 0: { halign: "center", cellWidth: 20 } }
  });

  doc.save(`${studentRoll}_quiz_result.pdf`);

  document.getElementById("quiz-form").classList.add("hidden");
  document.getElementById("result").classList.remove("hidden");
  document.getElementById("result").innerHTML = `
    <p><b>Quiz Completed!</b></p>
    <p>Your Score: ${score}/${questions.length}</p>
    <p>PDF file downloaded ✅</p>
  `;
});
</script>
</body>
</html>
