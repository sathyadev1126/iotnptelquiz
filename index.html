<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NPTEL Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f7fb;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      max-width: 700px;
      width: 95%;
    }

    h1 {
      text-align: center;
      font-size: 1.5rem;
    }

    .question-number {
      font-weight: bold;
      margin-bottom: 10px;
    }

    .question-img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 10px auto;
    }

    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 10px 0;
    }

    .options label {
      background: #e3f2fd;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: background 0.2s;
      font-size: 1rem;
    }

    .options input {
      display: none;
    }

    .options input:checked + label {
      background: #64b5f6;
      color: white;
    }

    button {
      display: inline-block;
      margin: 15px 5px;
      padding: 12px 24px;
      background: #1565c0;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }

    button:hover {
      background: #0d47a1;
    }

    .hidden {
      display: none;
    }

    #timer {
      text-align: right;
      font-weight: bold;
      color: #d32f2f;
      font-size: 1rem;
    }

    @media screen and (max-width: 480px) {
      .options {
        grid-template-columns: 1fr;
      }
      .options label {
        font-size: 0.9rem;
        padding: 10px;
      }
      h1 {
        font-size: 1.3rem;
      }
      button {
        font-size: 0.95rem;
        padding: 10px 20px;
      }
      #timer {
        font-size: 0.95rem;
      }
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>NPTEL Quiz</h1>

    <div id="student-info">
      <p><b>Enter your details to start:</b></p>
      <input type="text" id="name" placeholder="Your Name" required /><br /><br />
      <input type="text" id="roll" placeholder="Your Roll Number" required /><br /><br />
      <button onclick="startQuiz()">Start Quiz</button>
    </div>

    <form id="quiz-form" class="hidden">
      <div id="timer">Time Left: <span id="time">30:00</span></div>
      <div id="quiz-container"></div>
      <div style="text-align:center;">
        <button type="button" id="nextBtn">Next</button>
        <button type="submit" id="submitBtn" class="hidden">Submit Quiz</button>
      </div>
    </form>

    <div id="result" class="hidden"></div>
  </div>

  <script>
    let questions = [
       { img: "images/s1.png", correct: "d" },
      { img: "images/s2.png", correct: "a" },
      { img: "images/s3.png", correct: "a" },
      { img: "images/s4.png", correct: "b" },
      { img: "images/s5.png", correct: "c" },
      { img: "images/s6.png", correct: "b" },
      { img: "images/s7.png", correct: "a" },
      { img: "images/s8.png", correct: "b" },
      { img: "images/s9.png", correct: "d" },
      { img: "images/s10.png", correct: "a" },
      { img: "images/s11.png", correct: "c" },
      { img: "images/s12.png", correct: "a" },
      { img: "images/s13.png", correct: "d" },
      { img: "images/s14.png", correct: "b" },
      { img: "images/s15.png", correct: "d" },
      { img: "images/s16.png", correct: "d" },
      { img: "images/s17.png", correct: "d" },
      { img: "images/s18.png", correct: "d" },
      { img: "images/s19.png", correct: "b" },
      { img: "images/s20.png", correct: "d" },
      { img: "images/s21.png", correct: "d" },
      { img: "images/s22.png", correct: "d" },
      { img: "images/s23.png", correct: "b" },
      { img: "images/s24.png", correct: "b" },
      { img: "images/s25.png", correct: "c" },
      { img: "images/s26.png", correct: "b" },
      { img: "images/s27.png", correct: "a" },
      { img: "images/s28.png", correct: "a" },
      { img: "images/s29.png", correct: "b" },
      { img: "images/s30.png", correct: "b" },
      { img: "images/s31.png", correct: "d" },
      { img: "images/s32.png", correct: "a" },
      { img: "images/s33.png", correct: "b" },
      { img: "images/s34.png", correct: "c" },
      { img: "images/s35.png", correct: "a" },
      { img: "images/s36.png", correct: "c" },
      { img: "images/s37.png", correct: "d" },
      { img: "images/s38.png", correct: "b" },
      { img: "images/s39.png", correct: "b" },
      { img: "images/s40.png", correct: "b" },
      { img: "images/s41.png", correct: "a" },
      { img: "images/s42.png", correct: "c" },
      { img: "images/s43.png", correct: "c" },
      { img: "images/s44.png", correct: "a" },
      { img: "images/s45.png", correct: "a" },
      { img: "images/s46.png", correct: "d" },
      { img: "images/s47.png", correct: "d" },
      { img: "images/s48.png", correct: "b" },
      { img: "images/s49.png", correct: "d" },
      { img: "images/s50.png", correct: "b" },
      { img: "images/s51.png", correct: "c" },
      { img: "images/s52.png", correct: "a" },
      { img: "images/s53.png", correct: "b" },
      { img: "images/s54.png", correct: "d" },
      { img: "images/s55.png", correct: "b" },
      { img: "images/s56.png", correct: "b" },
      { img: "images/s57.png", correct: "c" },
      { img: "images/s58.png", correct: "a" },
      { img: "images/s59.png", correct: "a" },
      { img: "images/s60.png", correct: "b" },
      { img: "images/s61.png", correct: "a" },
      { img: "images/s62.png", correct: "c" },
      { img: "images/s63.png", correct: "b" },
      { img: "images/s64.png", correct: "a" },
      { img: "images/s65.png", correct: "b" },
      { img: "images/s66.png", correct: "d" },
      { img: "images/s67.png", correct: "d" },
      { img: "images/s68.png", correct: "c" },
      { img: "images/s69.png", correct: "a" },
      { img: "images/s70.png", correct: "a" },
      { img: "images/s71.png", correct: "b" },
      { img: "images/s72.png", correct: "b" },
      { img: "images/s73.png", correct: "a" },
      { img: "images/s74.png", correct: "b" },
      { img: "images/s75.png", correct: "c" },
      { img: "images/s76.png", correct: "a" },
      { img: "images/s77.png", correct: "a" },
      { img: "images/s78.png", correct: "b" },
      { img: "images/s79.png", correct: "c" },
      { img: "images/s80.png", correct: "d" },
      { img: "images/s81.png", correct: "b" },
      { img: "images/s82.png", correct: "a" },
      { img: "images/s83.png", correct: "b" },
      { img: "images/s84.png", correct: "c" },
      { img: "images/s85.png", correct: "b" },
      { img: "images/s86.png", correct: "a" },
      { img: "images/s87.png", correct: "a" },
      { img: "images/s88.png", correct: "c" },
      { img: "images/s89.png", correct: "b" },
      { img: "images/s90.png", correct: "b" },
      { img: "images/s91.png", correct: "b" },
      { img: "images/s92.png", correct: "d" },
      { img: "images/s93.png", correct: "b" },
      { img: "images/s94.png", correct: "b" },
      { img: "images/s95.png", correct: "c" },
      { img: "images/s96.png", correct: "b" },
      { img: "images/s97.png", correct: "c" },
      { img: "images/s98.png", correct: "c" },
      { img: "images/s99.png", correct: "b" },
      { img: "images/s100.png", correct: "c" },
      { img: "images/s101.png", correct: "b" },
      { img: "images/s102.png", correct: "b" },
      { img: "images/s103.png", correct: "b" },
      { img: "images/s104.png", correct: "b" },
      { img: "images/s105.png", correct: "b" },
    ];

    // Shuffle function
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    let studentName = "";
    let studentRoll = "";
    let timerInterval;
    let totalTime = 30 * 60;
    let currentQuestion = 0;
    let answers = {};

    function startQuiz() {
      studentName = document.getElementById("name").value.trim();
      studentRoll = document.getElementById("roll").value.trim();

      if (!studentName || !studentRoll) {
        alert("Please enter your name and roll number.");
        return;
      }

      // Shuffle questions once at the start
      questions = shuffleArray(questions);

      document.getElementById("student-info").classList.add("hidden");
      document.getElementById("quiz-form").classList.remove("hidden");

      renderQuestion();
      startTimer();
    }

    function renderQuestion() {
      const q = questions[currentQuestion];
      const quizContainer = document.getElementById("quiz-container");

      quizContainer.innerHTML = `
        <div class="question-number">Question ${currentQuestion + 1} of ${questions.length}</div>
        <img src="${q.img}" alt="Question ${currentQuestion + 1}" class="question-img" />
        <div class="options">
          <input type="radio" id="qa" name="q" value="a" ${answers[currentQuestion]==="a"?"checked":""}/>
          <label for="qa">A</label>

          <input type="radio" id="qb" name="q" value="b" ${answers[currentQuestion]==="b"?"checked":""}/>
          <label for="qb">B</label>

          <input type="radio" id="qc" name="q" value="c" ${answers[currentQuestion]==="c"?"checked":""}/>
          <label for="qc">C</label>

          <input type="radio" id="qd" name="q" value="d" ${answers[currentQuestion]==="d"?"checked":""}/>
          <label for="qd">D</label>
        </div>
      `;

      document.getElementById("nextBtn").classList.remove("hidden");
      document.getElementById("submitBtn").classList.add("hidden");

      if (currentQuestion === questions.length - 1) {
        document.getElementById("nextBtn").classList.add("hidden");
        document.getElementById("submitBtn").classList.remove("hidden");
      }
    }

    document.getElementById("nextBtn").addEventListener("click", () => {
      const selected = document.querySelector('input[name="q"]:checked');
      if (selected) answers[currentQuestion] = selected.value;

      if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        renderQuestion();
      }
    });

    function startTimer() {
      const timeDisplay = document.getElementById("time");
      let timeLeft = totalTime;

      timerInterval = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timeDisplay.textContent = `${minutes.toString().padStart(2,"0")}:${seconds.toString().padStart(2,"0")}`;

        if (timeLeft === 0) {
          clearInterval(timerInterval);
          alert("Time's up! Submitting your quiz...");
          document.getElementById("quiz-form").requestSubmit();
        }
        timeLeft--;
      }, 1000);
    }

    document.getElementById("quiz-form").addEventListener("submit", (e) => {
      e.preventDefault();
      clearInterval(timerInterval);

      const selected = document.querySelector('input[name="q"]:checked');
      if (selected) answers[currentQuestion] = selected.value;

      let score = 0;
      let attempted = 0;
      let tableData = [];

      questions.forEach((q, index) => {
        const correct = q.correct;
        const userAns = answers[index] || "-";
        if (userAns !== "-") attempted++;
        if (userAns === correct) score++;

        let imgName = q.img.split("/").pop();
        tableData.push([
          { content: (index+1).toString(), styles:{halign:"center"} },
          imgName,
          userAns.toUpperCase(),
          correct.toUpperCase(),
          (userAns===correct)?"Correct":"Wrong"
        ]);
      });

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text(`NPTEL Quiz Report`, 14, 20);
      doc.setFontSize(12);
      doc.text(`Name: ${studentName}`, 14, 30);
      doc.text(`Roll Number: ${studentRoll}`, 14, 36);
      doc.text(`Score: ${score} / ${questions.length}`, 14, 42);
      doc.text(`Attempted: ${attempted} / ${questions.length}`, 14, 48);

      doc.autoTable({
        startY: 55,
        head: [['Q No.', 'Image File', 'Your Answer', 'Correct Answer', 'Status']],
        body: tableData,
        styles: { fontSize: 9 },
        headStyles: { fillColor: [21, 101, 192], halign: 'center' },
        columnStyles: {
          0: { cellWidth: 12 },
          1: { cellWidth: 40 },
          2: { cellWidth: 25, halign: 'center' },
          3: { cellWidth: 30, halign: 'center' },
          4: { cellWidth: 25, halign: 'center' }
        }
      });

      doc.save(`NPTEL_Quiz_Report_${studentRoll}.pdf`);

      document.getElementById("result").innerHTML = `
        <h3>Your score: ${score} / ${questions.length}</h3>
        <p>You attempted ${attempted} questions.</p>
        <p>PDF report downloaded.</p>
      `;
      document.getElementById("result").classList.remove("hidden");
      document.getElementById("quiz-form").classList.add("hidden");
    });
  </script>
</body>
</html>
